const fileModel = require('../models/file.model');
const fs = require('fs');
const multer = require('multer');
const moment = require('moment');

exports.testing = (req, res, next) => {
    res.send('Admin Router works well!');
}

/** Multer configuration */
//Image storage
const multerStorage = multer.diskStorage({
    destination: (req, file, callback) => {
        callback(null, './uploads')
    },
    filename: (req, file, callback) => {
        callback(null, `file-${moment(new Date()).format('DD-MM-YYYY')}-${file.originalname}`)
    }
})

exports.upload = multer({ storage: multerStorage});

exports.attachFile = (req, res, next) => {
    req.body.fileAttachment = req.file.filename;
    next();
}

exports.add = (req, res, next) => {
    fileModel.create(req.body)
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.update = (req, res, next) => {
    fileModel.findByIdAndUpdate(req.query.id)
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findByPatientId = (req, res, next) => {
    fileModel.find({patientId :req.query.patientId})
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findByHospitalId = (req, res, next) => {
    fileModel.find({hospitalId :req.query.hospitalId})
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findByType = (req, res, next) => {
    fileModel.find({type :req.query.type})
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findByDoctorId = (req, res, next) => {
    fileModel.find({doctorId :req.query.doctorId})
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findByCreationDate = (req, res, next) => {
    fileModel.find({creationDate :req.query.creationDate})
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findAll = (req, res, next) => {
    fileModel.find() 
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}

exports.findById = (req, res, next) => {
    fileModel.findById(req.query.id) 
    .then(response => {
        res.status(201).send(response);
    })
    .catch(err => {
        res.status(500).send(`Server error ${err}`)
    })
}